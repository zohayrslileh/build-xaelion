"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Json=void 0;const fs_1=require("fs"),chokidar_1=require("chokidar"),path_1=require("path");class Json{path;schema;constructor(t,e){this.path=(0,path_1.resolve)(t),this.schema=e,this.create=this.create.bind(this),this.update=this.update.bind(this),this.onUpdate=this.onUpdate.bind(this)}create(){(0,fs_1.existsSync)(this.path)||((0,fs_1.mkdirSync)((0,path_1.dirname)(this.path),{recursive:!0}),(0,fs_1.writeFileSync)(this.path,"{}"))}get read(){this.create();try{var t=JSON.parse((0,fs_1.readFileSync)(this.path,{encoding:"utf-8"}));return this.schema?Json.formatting(this.schema,t):t}catch{return Json.formatting(this.schema||{},{})}}update(t,e){this.create();t=t instanceof Function?t(this.read):t,t=this.schema?Json.formatting(this.schema,t):t;(0,fs_1.writeFileSync)(this.path,e?JSON.stringify(t):JSON.stringify(t,null,4))}onUpdate(t){this.create();var e=(0,chokidar_1.watch)(this.path,{awaitWriteFinish:{stabilityThreshold:10}});return e.on("change",t),e}static formatting(e,t){if(Array.isArray(e))return Array.isArray(t)?t.map(t=>"object"==typeof e[0]?Json.formatting(e[0],t):typeof e[0]==typeof t?t:e[0]):[];var s,i={};for(s of Object.keys(e))"object"==typeof e[s]?i[s]=Json.formatting(e[s],t?.[s]):i[s]=typeof t?.[s]==typeof e[s]?t?.[s]:e[s];return i}}function json(t,e){return new Json(t,e)}exports.Json=Json,exports.default=json;